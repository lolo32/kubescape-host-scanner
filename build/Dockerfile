FROM golang:1.18 as build
ARG BUILD_VERSION
WORKDIR /app/
COPY . ./
ENV CGO_ENABLED=0
RUN go get ./...
RUN go test -v ./...
RUN go build -o kube-host-sensor --ldflags "-w -s -X main.BuildVersion=$BUILD_VERSION"

FROM alpine
COPY --from=build /app/kube-host-sensor /.
ENTRYPOINT [ "./kube-host-sensor" ]
